{# templates/form/fields.html.twig #}
{% block leaflet_widget %}
        {% set mapurl = '//map.cardinalguild.com?hideheader=true&admin=true' %}
        {% if sonata_admin is not empty and sonata_admin.admin is not empty and sonata_admin.admin.subject is not empty %}
            {% set subject = sonata_admin.admin.subject %}
            {% if subject.lat is not empty %}
                {% set mapurl = (mapurl ~ '&lat=' ~ subject.lat) %}
            {% endif %}
            {% if subject.lng is not empty %}
                {% set mapurl = (mapurl ~ '&lng=' ~ subject.lng) %}
            {% endif %}
        {% endif %}
        <iframe id="{{ id }}" src="{{ mapurl }}" style="width: 100%;min-height: 240px; height: 80vh; border: none;" allow-scripts="true"></iframe>
        {% verbatim %}
        <script type="text/javascript">
            var uniqid = '{% endverbatim %}{{ sonata_admin.admin.uniqid }}{% verbatim %}';
            window.addEventListener('message', function(e) {
                if(e.data && e.data.id && e.data.lat && e.data.lng && e.data.id == "mapclick") {
                    var lat = e.data.lat;
                    var lng = e.data.lng;
                    if(lat > 0) {
                        lat = 0;
                    }
                    if(lat < -9500) {
                        lat =-9500;
                    }
                    if(lng < 0) {
                        lng = 0;
                    }
                    if(lng > 9500) {
                        lng = 9500;
                    }
                    document.getElementById(uniqid+'_lat').value = lat;
                    document.getElementById(uniqid+'_lng').value = lng;
                }
            });
        </script>
        {% endverbatim %}
{% endblock %}
